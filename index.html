<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SCAtak | LOS SANTOS EDITION</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chalet+Comprime&family=Inter:wght@400;700;900&display=swap');

        :root {
            --bg: #000;
            --hud-bg: rgba(0, 0, 0, 0.75);
            --hud-border: 2px solid rgba(255, 255, 255, 0.2);
            --gps-purple: #a855f7;
            --gps-yellow: #facc15;
            --health-green: #22c55e;
            --armor-blue: #3b82f6;
            --font-gta: 'Inter', sans-serif; /* Closest web safe to Chalet */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; background: #111; overflow: hidden; height: 100dvh; display: flex; flex-direction: column; font-family: var(--font-gta); }

        /* --- MAP CONTAINER --- */
        #map { flex: 1; width: 100%; height: 100%; z-index: 0; background: #1a1a1a; }

        /* --- HUD: RADAR (MINIMAP STYLE) --- */
        /* Note: We keep full screen map but style elements to look like the HUD */

        /* --- HUD: BOTTOM INFO --- */
        .hud-zone-box {
            position: absolute; bottom: 40px; right: 20px;
            text-align: right; z-index: 500; pointer-events: none;
            text-shadow: 0 0 4px #000, 2px 2px 0 #000;
        }
        .hud-zone-name { font-size: 28px; font-weight: 900; color: white; text-transform: uppercase; letter-spacing: -0.5px; }
        .hud-street-name { font-size: 16px; font-weight: 600; color: #ccc; text-transform: uppercase; margin-top: -5px; }

        /* --- HUD: METRICS (BARS) --- */
        .hud-stats {
            position: absolute; bottom: 20px; left: 20px; z-index: 500;
            display: flex; gap: 5px; width: 180px; height: 8px;
        }
        .stat-bar { flex: 1; height: 100%; background: #333; border-radius: 2px; overflow: hidden; }
        .stat-fill { height: 100%; width: 100%; }
        .fill-green { background: var(--health-green); }
        .fill-blue { background: var(--armor-blue); }

        /* --- HUD: WANTED LEVEL (ALERTS) --- */
        .wanted-level {
            position: absolute; top: 20px; right: 20px; z-index: 500;
            display: flex; gap: 5px; opacity: 0; transition: opacity 0.3s;
        }
        .wanted-star { font-size: 20px; color: white; }
        .wanted-active { color: white; animation: flash 1s infinite; }
        @keyframes flash { 0%, 100% {color:white;} 50% {color:red;} }

        /* --- NAVIGATION PANEL --- */
        .nav-search-box {
            position: absolute; top: 20px; left: 20px; z-index: 500;
            background: #000; border: 2px solid #333; border-radius: 50px;
            display: flex; align-items: center; padding: 10px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 80%; max-width: 300px;
        }
        .nav-input { background: none; border: none; color: white; font-size: 16px; font-weight: 700; width: 100%; outline: none; text-transform: uppercase; }
        .nav-icon { color: #666; margin-right: 10px; }

        /* --- DISTANCE COUNTER --- */
        .dist-box {
            position: absolute; bottom: 120px; right: 20px;
            background: rgba(0,0,0,0.8); padding: 10px 15px; border-radius: 8px;
            border-left: 4px solid var(--gps-yellow); color: white;
            font-family: 'Courier New', monospace; font-weight: bold;
            display: none; z-index: 500;
        }

        /* --- MENU (PHONE STYLE) --- */
        .phone-btn {
            position: absolute; bottom: 20px; right: 20px; width: 50px; height: 50px;
            background: #222; border: 2px solid #444; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 20px; z-index: 600; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); display: none; /* Hidden for pure HUD look */
        }

        /* --- LEAFLET OVERRIDES --- */
        .leaflet-routing-container { display: none !important; } /* Hide the text directions box */
        .leaflet-control-attribution { display: none !important; }

        /* CUSTOM MARKERS */
        .blip {
            width: 14px; height: 14px; background: var(--gps-yellow);
            border: 2px solid black; border-radius: 50%;
            box-shadow: 0 0 0 2px var(--gps-yellow);
        }
        .player-arrow {
            width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent;
            border-bottom: 16px solid white; filter: drop-shadow(0 0 2px black);
        }

    </style>
</head>
<body>

    <div class="nav-search-box">
        <i class="fa-solid fa-magnifying-glass nav-icon"></i>
        <input type="text" id="destInput" class="nav-input" placeholder="SET WAYPOINT..." onchange="routeToInput()">
    </div>

    <div class="wanted-level" id="alertBox">
        <i class="fa-solid fa-star wanted-star wanted-active"></i>
        <i class="fa-solid fa-star wanted-star wanted-active"></i>
        <i class="fa-solid fa-star wanted-star wanted-active"></i>
        <i class="fa-solid fa-star wanted-star wanted-active"></i>
        <i class="fa-solid fa-star wanted-star wanted-active"></i>
    </div>

    <div class="dist-box" id="distDisplay">
        <div style="font-size:10px; color:#aaa;">DISTANCE</div>
        <div style="font-size:18px;" id="distVal">0.0 mi</div>
    </div>

    <div class="hud-zone-box">
        <div class="hud-zone-name" id="zoneName">CALVERT CTY</div>
        <div class="hud-street-name" id="streetName">SCIENTISTS CLIFFS</div>
    </div>

    <div class="hud-stats">
        <div class="stat-bar"><div class="stat-fill fill-green" style="width: 85%;"></div></div>
        <div class="stat-bar"><div class="stat-fill fill-blue" style="width: 100%;"></div></div>
    </div>

    <div id="map"></div>

    <script>
        // --- 1. MAP SETUP ---
        // Using CartoDB Dark Matter for that high-contrast GTA V Pause Menu look
        const map = L.map('map', {zoomControl: false}).setView([38.515, -76.513], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 19
        }).addTo(map);

        // --- 2. PLAYER MARKER ---
        const playerIcon = L.divIcon({
            className: 'player-arrow-wrap',
            html: '<div class="player-arrow"></div>',
            iconSize: [16, 16],
            iconAnchor: [8, 8]
        });
        let playerMarker = L.marker([38.515, -76.513], {icon: playerIcon}).addTo(map);

        // --- 3. ROUTING ENGINE (OSRM) ---
        let control = null;
        let waypointMarker = null;

        function calculateRoute(destLat, destLng) {
            // Remove old route
            if (control) {
                map.removeControl(control);
                control = null;
            }
            if (waypointMarker) {
                map.removeLayer(waypointMarker);
            }

            // Add "Blip" marker at destination
            const blipIcon = L.divIcon({className: 'blip-wrap', html: '<div class="blip"></div>', iconSize:[14,14]});
            waypointMarker = L.marker([destLat, destLng], {icon: blipIcon}).addTo(map);

            // Get current user pos
            const startLat = playerMarker.getLatLng().lat;
            const startLng = playerMarker.getLatLng().lng;

            // Initialize Routing
            control = L.Routing.control({
                waypoints: [
                    L.latLng(startLat, startLng),
                    L.latLng(destLat, destLng)
                ],
                routeWhileDragging: false,
                show: false, // Hide instructions panel
                createMarker: function() { return null; }, // Don't create default markers
                lineOptions: {
                    styles: [{color: '#a855f7', opacity: 0.8, weight: 8}] // GTA Purple Line
                }
            }).addTo(map);

            // Event: Route Found
            control.on('routesfound', function(e) {
                const routes = e.routes;
                const summary = routes[0].summary;
                // Update HUD
                document.getElementById('distDisplay').style.display = 'block';
                document.getElementById('distVal').innerText = (summary.totalDistance / 1609).toFixed(2) + " mi";
                
                // Alert Sound
                // new Audio('https://www.myinstants.com/media/sounds/gta-v-mission-passed.mp3').play(); (Optional)
            });
        }

        // --- 4. MAP CLICK TO WAYPOINT ---
        map.on('click', function(e) {
            calculateRoute(e.latlng.lat, e.latlng.lng);
            document.getElementById('streetName').innerText = "WAYPOINT SET";
        });

        // --- 5. SEARCH LOGIC ---
        const LOCATIONS = {
            'GATE A': [38.528, -76.516],
            'GATE B': [38.522, -76.514],
            'GATE C': [38.515, -76.513],
            'GATE D': [38.510, -76.512],
            'GATE E': [38.503, -76.509],
            'COMMUNITY': [38.514, -76.515],
            'POOL': [38.516, -76.512]
        };

        function routeToInput() {
            const val = document.getElementById('destInput').value.toUpperCase().trim();
            // Fuzzy match keys
            let found = null;
            Object.keys(LOCATIONS).forEach(k => {
                if (val.includes(k) || (val.length === 1 && k.includes('GATE ' + val))) {
                    found = LOCATIONS[k];
                    document.getElementById('destInput').value = k; // Auto-complete
                }
            });

            if (found) {
                calculateRoute(found[0], found[1]);
                document.getElementById('streetName').innerText = "ROUTING...";
            } else {
                alert("LOCATION UNKNOWN. TRY 'GATE A' OR 'POOL'");
            }
        }

        // --- 6. GPS TRACKING (CHASE CAM) ---
        function startGPS() {
            if ('geolocation' in navigator) {
                navigator.geolocation.watchPosition(pos => {
                    const lat = pos.coords.latitude;
                    const lng = pos.coords.longitude;
                    const speed = pos.coords.speed ? Math.round(pos.coords.speed * 2.237) : 0;
                    
                    // Update Player
                    const newLatLng = new L.LatLng(lat, lng);
                    playerMarker.setLatLng(newLatLng);
                    
                    // Chase Cam: Center map on player
                    map.panTo(newLatLng);

                    // Update Street Name (Simulated Zone Logic)
                    updateZoneDisplay(lat);

                }, err => {
                    console.error(err);
                }, {
                    enableHighAccuracy: true,
                    maximumAge: 1000,
                    timeout: 5000
                });
            }
        }

        // Simple latitude check to guess which "Gate Zone" you are in
        function updateZoneDisplay(lat) {
            let zone = "UNKNOWN";
            if (lat > 38.525) zone = "GATE A ZONE";
            else if (lat > 38.520) zone = "GATE B ZONE";
            else if (lat > 38.513) zone = "GATE C ZONE";
            else if (lat > 38.508) zone = "GATE D ZONE";
            else zone = "GATE E ZONE";
            
            document.getElementById('zoneName').innerText = zone;
        }

        // Start
        startGPS();
        
        // Mock Alert Logic (Trigger "Wanted Stars" if panic)
        // setTimeout(() => { document.getElementById('alertBox').style.opacity = 1; }, 5000);

    </script>
</body>
</html>
