<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Team Command Center</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root { --primary: #2563eb; --success: #22c55e; --warning: #f59e0b; }
        body { font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Map Area */
        #map { flex: 1; width: 100%; }

        /* Dashboard Slide-up */
        .dashboard { 
            height: 40vh; background: white; border-top: 3px solid var(--primary);
            display: flex; flex-direction: column; z-index: 1000;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.2);
        }

        .tabs { display: flex; background: #eee; }
        .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; font-weight: bold; border-bottom: 2px solid transparent; }
        .tab.active { background: white; border-bottom: 2px solid var(--primary); }

        .content-area { flex: 1; overflow-y: auto; padding: 15px; }
        .hidden { display: none; }

        /* Controls */
        .input-group { margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        .btn { background: var(--primary); color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; font-weight: bold; }

        /* Message Board */
        .msg-card { background: #f9f9f9; padding: 10px; border-radius: 5px; margin-bottom: 8px; border-left: 4px solid var(--primary); }
        .msg-meta { font-size: 0.7rem; color: #777; }

        /* Custom Marker Styles */
        .custom-marker { border-radius: 50%; border: 3px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="dashboard">
        <div class="tabs">
            <div class="tab active" onclick="showTab('status')">My Status</div>
            <div class="tab" onclick="showTab('board')">Message Board</div>
        </div>

        <div id="status-tab" class="content-area">
            <input type="text" id="username" placeholder="Your Name (e.g. Unit 1)">
            <select id="userColor">
                <option value="blue">Blue Icon</option>
                <option value="red">Red Icon</option>
                <option value="green">Green Icon</option>
                <option value="orange">Orange Icon</option>
            </select>
            <select id="userStatus">
                <option value="Active">Status: Active</option>
                <option value="Busy">Status: Busy</option>
                <option value="On Break">Status: On Break</option>
            </select>
            <input type="text" id="currentTask" placeholder="Current Tasking...">
            <button class="btn" onclick="updateCloud()">Update My Location & Info</button>
        </div>

        <div id="board-tab" class="content-area hidden">
            <textarea id="boardInput" placeholder="Post a tasking or message for the team..."></textarea>
            <button class="btn" onclick="postMessage()">Post to Board</button>
            <div id="messageList" style="margin-top: 15px;">
                </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. Initialize Map with Traffic-style tiles
        const map = L.map('map').setView([38.8951, -77.0364], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        let userMarkers = {};

        // 2. Tab Switching Logic
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-area').forEach(c => c.classList.add('hidden'));
            event.currentTarget.classList.add('active');
            document.getElementById(tabName + '-tab').classList.remove('hidden');
        }

        // 3. Location Tracking
        function updateCloud() {
            const name = document.getElementById('username').value;
            const color = document.getElementById('userColor').value;
            const status = document.getElementById('userStatus').value;
            const task = document.getElementById('currentTask').value;

            if(!name) return alert("Enter your name first");

            navigator.geolocation.getCurrentPosition((pos) => {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;

                // IN A REAL APP: You would send this JSON to Firebase:
                // { name, lat, lng, color, status, task }
                
                updateLocalMarker(name, lat, lng, color, status, task);
                alert("Status Uploaded to Team");
            });
        }

        function updateLocalMarker(name, lat, lng, color, status, task) {
            if (userMarkers[name]) map.removeLayer(userMarkers[name]);

            const iconHtml = `<div style="background-color:${color}; width:20px; height:20px; border-radius:50%; border:2px solid white;"></div>`;
            const customIcon = L.divIcon({ html: iconHtml, className: 'custom-pin' });

            userMarkers[name] = L.marker([lat, lng], {icon: customIcon}).addTo(map)
                .bindPopup(`<b>${name}</b><br>Status: ${status}<br>Task: ${task}`)
                .openPopup();
            
            map.setView([lat, lng], 15);
        }

        function postMessage() {
            const text = document.getElementById('boardInput').value;
            if(!text) return;
            const list = document.getElementById('messageList');
            const card = `<div class="msg-card"><strong>${document.getElementById('username').value || 'User'}:</strong> ${text}<br><span class="msg-meta">${new Date().toLocaleTimeString()}</span></div>`;
            list.insertAdjacentHTML('afterbegin', card);
            document.getElementById('boardInput').value = "";
        }
    </script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // 2. YOUR CONFIG (Paste what you copied from Firebase here)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "your-app.firebaseapp.com",
    databaseURL: "https://your-app-default-rtdb.firebaseio.com",
    projectId: "your-app",
    storageBucket: "your-app.appspot.com",
    messagingSenderId: "12345",
    appId: "1:12345:web:6789"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // 3. PUSH LOCATION TO CLOUD
  function updateCloud() {
    const name = document.getElementById('username').value;
    const color = document.getElementById('userColor').value;
    const status = document.getElementById('userStatus').value;
    const task = document.getElementById('currentTask').value;

    if(!name) return alert("Enter your name first");

    navigator.geolocation.getCurrentPosition((pos) => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;

      // Save to Firebase under the user's name
      db.ref('employees/' + name).set({
        lat: lat,
        lng: lng,
        color: color,
        status: status,
        task: task,
        lastSeen: Date.now()
      });
    });
  }

  // 4. LISTEN FOR TEAM UPDATES (The "Live" Part)
  db.ref('employees/').on('value', (snapshot) => {
    const data = snapshot.val();
    for (let id in data) {
      const emp = data[id];
      updateLocalMarker(id, emp.lat, emp.lng, emp.color, emp.status, emp.task);
    }
  });

  // 5. MESSAGE BOARD SYNC
  function postMessage() {
    const text = document.getElementById('boardInput').value;
    const user = document.getElementById('username').value || 'Anonymous';
    if(!text) return;

    db.ref('messages/').push({
      user: user,
      text: text,
      time: new Date().toLocaleTimeString()
    });
    document.getElementById('boardInput').value = "";
  }

  db.ref('messages/').limitToLast(10).on('child_added', (snapshot) => {
    const msg = snapshot.val();
    const list = document.getElementById('messageList');
    const card = `<div class="msg-card"><strong>${msg.user}:</strong> ${msg.text}</div>`;
    list.insertAdjacentHTML('afterbegin', card);
  });
</script>
</body>
</html>